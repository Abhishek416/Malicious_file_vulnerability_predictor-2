from __future__ import print_function
import json
import hashlib
from virus_total_apis import PublicApi as VirusTotalPublicApi

import time
import json
from os import path

API_KEY = [
    "64ebf41554c854ad452d2f3060708d1e3f7e09aa5c1546ecf271194b49d2568d",
    "64ebf41554c854ad452d2f3060708d1e3f7e09aa5c1546ecf271194b49d2568d"
]

def getit(SHA512):
    index = 0
    for api in API_KEY:
        vt = VirusTotalPublicApi(api)
        for sha in range(index, index+4):
            response = vt.get_file_report(SHA512[sha])
            if response['error'] == "":
                listObj.append(response)
            print(listObj)
        index += 4

    with open(filename, 'w') as json_file:
        json.dump(listObj, json_file)

    print('Successfully appended to the JSON file')

file1 = open('full_sha256.txt', 'r')

filename = 'result.json'
listObj = []

# Check if file exists
if path.isfile(filename) is False:
    raise Exception("File not found")

# Read JSON file
with open(filename) as fp:
    listObj = json.load(fp)

print(listObj)

starttime = time.time()

while True:
    EICAR_SHA = []
    for i in range(0, len(API_KEY)*4):
        line = file1.readline()
        EICAR_SHA.append(line.strip())
    getit(EICAR_SHA)
    time.sleep(60.0 - ((time.time() - starttime) % 60.0))